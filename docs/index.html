<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Visualiza√ß√£o de dados abertos do Parlamento Portugu√™s - Iniciativas legislativas e agenda parlamentar da XVII Legislatura">
    <title>Viriato - Dados Abertos do Parlamento Portugu√™s</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Skip to content - Accessibility -->
    <a href="#main-content" class="skip-link">Saltar para o conte√∫do</a>

    <!-- Navigation -->
    <nav class="main-nav" role="navigation" aria-label="Navega√ß√£o principal">
        <div class="nav-container">
            <div class="logo" aria-label="Viriato - P√°gina inicial">Viriato</div>
            <div class="nav-tabs" role="tablist" aria-label="Sec√ß√µes do site">
                <a href="#/" class="nav-tab" data-view="home" role="tab" aria-selected="true">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                    <span class="nav-label">Home</span>
                </a>
                <a href="#/assembleia" class="nav-tab" data-view="assembleia" role="tab" aria-selected="false">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 20h20"/><path d="M5 20V8l7-5 7 5v12"/><path d="M9 20v-6h6v6"/><path d="M8 8h.01"/><path d="M16 8h.01"/><path d="M8 12h.01"/><path d="M16 12h.01"/></svg>
                    <span class="nav-label">A Assembleia</span>
                </a>
                <a href="#/iniciativas" class="nav-tab" data-view="iniciativas" role="tab" aria-selected="false">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
                    <span class="nav-label">Iniciativas</span>
                </a>
                <a href="#/agenda" class="nav-tab" data-view="agenda" role="tab" aria-selected="false">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                    <span class="nav-label">Agenda</span>
                </a>
                <a href="#/comissoes" class="nav-tab" data-view="comissoes" role="tab" aria-selected="false">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                    <span class="nav-label">Comiss√µes</span>
                </a>
            </div>
            <button class="feedback-cta" onclick="openFeedbackModal()" aria-label="Enviar sugest√µes">
                <svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M7.549 10.078c.46.182.88.424 1.258.725.378.3.701.65.97 1.046a4.829 4.829 0 0 1 .848 2.714V15H9.75v-.438a3.894 3.894 0 0 0-1.155-2.782 4.054 4.054 0 0 0-1.251-.84 3.898 3.898 0 0 0-1.532-.315A3.894 3.894 0 0 0 3.03 11.78a4.06 4.06 0 0 0-.84 1.251c-.206.474-.31.985-.315 1.531V15H1v-.438a4.724 4.724 0 0 1 .848-2.713 4.918 4.918 0 0 1 2.229-1.77 2.994 2.994 0 0 1-.555-.493 3.156 3.156 0 0 1-.417-.602 2.942 2.942 0 0 1-.26-.683 3.345 3.345 0 0 1-.095-.739c0-.423.08-.82.24-1.189a3.095 3.095 0 0 1 1.626-1.627 3.067 3.067 0 0 1 2.386-.007 3.095 3.095 0 0 1 1.627 1.627 3.067 3.067 0 0 1 .157 1.928c-.06.237-.148.465-.266.684a3.506 3.506 0 0 1-.417.608c-.16.187-.345.35-.554.492zM5.812 9.75c.301 0 .584-.057.848-.17a2.194 2.194 0 0 0 1.162-1.163c.119-.269.178-.554.178-.854a2.138 2.138 0 0 0-.643-1.538 2.383 2.383 0 0 0-.697-.472 2.048 2.048 0 0 0-.848-.178c-.3 0-.583.057-.847.17a2.218 2.218 0 0 0-1.17 1.17c-.113.264-.17.547-.17.848 0 .3.057.583.17.847.115.264.27.497.466.697a2.168 2.168 0 0 0 1.552.643zM15 1v7h-1.75l-2.625 2.625V8H9.75v-.875h1.75v1.388l1.388-1.388h1.237v-5.25h-8.75v1.572a7.255 7.255 0 0 0-.438.069 2.62 2.62 0 0 0-.437.123V1H15z"/></svg>
                Sugest√µes
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <main id="main-content">

    <!-- HOME VIEW -->
    <div id="home-view" class="view active home-view" role="tabpanel" aria-labelledby="home-tab">
        <div class="container">
            <div class="home-header">
                <h1>Viriato</h1>
                <div class="home-subtitle">Dados Abertos do Parlamento Portugu√™s</div>
                <div class="home-description">
                    Visualiza√ß√£o da atividade legislativa da XVII Legislatura (2025-presente).
                    Explore a agenda parlamentar e as iniciativas legislativas.
                </div>
            </div>

            <div class="viewers">
                <div class="viewer-card" onclick="navigateTo('#/assembleia')" onkeydown="handleCardKeydown(event, '#/assembleia')" tabindex="0" role="button" aria-label="Ver A Assembleia">
                    <div class="viewer-icon" aria-hidden="true">üë•</div>
                    <div class="viewer-title">A Assembleia</div>
                    <div class="viewer-description">
                        Explore os deputados por partido, c√≠rculo eleitoral, g√©nero e comiss√µes.
                    </div>
                    <div class="viewer-stats">
                        <div class="stat">
                            <span class="stat-value" id="home-deputados-count">230</span>
                            <div class="stat-label">Deputados</div>
                        </div>
                        <div class="stat">
                            <span class="stat-value">22</span>
                            <div class="stat-label">C√≠rculos</div>
                        </div>
                    </div>
                </div>

                <div class="viewer-card" onclick="navigateTo('#/iniciativas')" onkeydown="handleCardKeydown(event, '#/iniciativas')" tabindex="0" role="button" aria-label="Ver Iniciativas Legislativas">
                    <div class="viewer-icon" aria-hidden="true">üìã</div>
                    <div class="viewer-title">Iniciativas Legislativas</div>
                    <div class="viewer-description">
                        Explore as iniciativas legislativas ao longo de todas as fases do processo parlamentar.
                    </div>
                    <div class="viewer-stats">
                        <div class="stat">
                            <span class="stat-value" id="home-ini-count">808</span>
                            <div class="stat-label">Iniciativas</div>
                        </div>
                        <div class="stat">
                            <span class="stat-value" id="home-ini-completed">102</span>
                            <div class="stat-label">Conclu√≠das</div>
                        </div>
                        <div class="stat">
                            <span class="stat-value">7</span>
                            <div class="stat-label">Tipos</div>
                        </div>
                    </div>
                </div>

                <div class="viewer-card" onclick="navigateTo('#/agenda')" onkeydown="handleCardKeydown(event, '#/agenda')" tabindex="0" role="button" aria-label="Ver Agenda Parlamentar">
                    <div class="viewer-icon" aria-hidden="true">üìÖ</div>
                    <div class="viewer-title">Agenda Parlamentar</div>
                    <div class="viewer-description">
                        Consulte o calend√°rio parlamentar com sess√µes plen√°rias, reuni√µes de comiss√µes e outros eventos.
                    </div>
                    <div class="viewer-stats">
                        <div class="stat">
                            <span class="stat-value" id="home-agenda-count">34</span>
                            <div class="stat-label">Eventos</div>
                        </div>
                        <div class="stat">
                            <span class="stat-value">Jan 2026</span>
                            <div class="stat-label">Atual</div>
                        </div>
                    </div>
                </div>

                <div class="viewer-card" onclick="navigateTo('#/comissoes')" onkeydown="handleCardKeydown(event, '#/comissoes')" tabindex="0" role="button" aria-label="Ver Comiss√µes Parlamentares">
                    <div class="viewer-icon" aria-hidden="true">üèõÔ∏è</div>
                    <div class="viewer-title">Comiss√µes Parlamentares</div>
                    <div class="viewer-description">
                        Consulte a composi√ß√£o partid√°ria e o trabalho das comiss√µes parlamentares.
                    </div>
                    <div class="viewer-stats">
                        <div class="stat">
                            <span class="stat-value" id="home-comissoes-count">18</span>
                            <div class="stat-label">Comiss√µes</div>
                        </div>
                        <div class="stat">
                            <span class="stat-value">XVII</span>
                            <div class="stat-label">Legislatura</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- INICIATIVAS VIEW -->
    <div id="iniciativas-view" class="view" role="tabpanel" aria-labelledby="iniciativas-tab">
        <div class="container">
            <div class="iniciativas-header">
                <h1>Iniciativas Legislativas</h1>
                <p>XVII Legislature (2025-present)</p>
                <div class="stats">
                    <div class="stat-box">
                        <div class="stat-number" id="ini-total">-</div>
                        <div class="stat-box-label">Total Iniciativas</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number" id="ini-completed">-</div>
                        <div class="stat-box-label">Completed</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number" id="ini-phases">60</div>
                        <div class="stat-box-label">Lifecycle Phases</div>
                    </div>
                </div>
            </div>

            <div class="iniciativas-layout">
                <!-- Sidebar with filters -->
                <aside class="filters-sidebar">
                    <h2>Filtros</h2>
                    <div class="filter-group">
                        <label class="filter-label" id="legislature-label">Legislatura</label>
                        <div class="filter-buttons" role="group" aria-labelledby="legislature-label">
                            <button class="filter-btn" data-legislature="all">Todas</button>
                            <button class="filter-btn active" data-legislature="XVII">XVII (2025-presente)</button>
                            <button class="filter-btn" data-legislature="XVI">XVI (2024-2025)</button>
                            <button class="filter-btn" data-legislature="XV">XV (2022-2024)</button>
                            <button class="filter-btn" data-legislature="XIV">XIV (2019-2022)</button>
                        </div>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label" id="filter-label">Tipo de Iniciativa</label>
                        <div class="filter-buttons" role="group" aria-labelledby="filter-label">
                            <button class="filter-btn active" data-type="all">Todos</button>
                            <button class="filter-btn" data-type="J">Projetos de Lei</button>
                            <button class="filter-btn" data-type="R">Projetos de Resolu√ß√£o</button>
                            <button class="filter-btn" data-type="P">Propostas de Lei</button>
                            <button class="filter-btn" data-type="D">Delibera√ß√µes</button>
                        </div>
                    </div>
                </aside>

                <!-- Main content -->
                <div class="iniciativas-main">
                    <div class="funnels">
                        <div class="funnel-container">
                            <div class="funnel-title">Leis - Estado Atual</div>
                            <div id="laws-funnel" class="funnel-chart"></div>
                        </div>
                        <div class="funnel-container">
                            <div class="funnel-title">Resolu√ß√µes - Estado Atual</div>
                            <div id="resolutions-funnel" class="funnel-chart"></div>
                        </div>
                    </div>

                    <!-- Analytics Widgets -->
                    <div class="analytics-grid" id="analytics-widgets">
                        <div class="widget">
                            <div class="widget-title">
                                <span class="widget-title-icon" aria-hidden="true">üìä</span>
                                Por Tipo
                            </div>
                            <div id="type-widget" class="type-grid">
                                <!-- Populated by JS -->
                            </div>
                        </div>
                        <div class="widget">
                            <div class="widget-title">
                                <span class="widget-title-icon" aria-hidden="true">üìÖ</span>
                                Por M√™s
                            </div>
                            <div id="month-widget" class="timeline-chart" style="margin-bottom: 30px;">
                                <!-- Populated by JS -->
                            </div>
                        </div>
                        <div class="widget">
                            <div class="widget-title">
                                <span class="widget-title-icon" aria-hidden="true">üë§</span>
                                Por Autor
                            </div>
                            <div id="author-widget" class="bar-chart">
                                <!-- Populated by JS -->
                            </div>
                        </div>
                    </div>

                    <!-- Search section (just above cards) -->
                    <div class="search-section">
                        <label class="filter-label" id="search-label">Pesquisar Iniciativas</label>
                        <div class="search-container" role="search">
                            <input type="text" id="search-input" class="search-input" placeholder="Pesquisar por t√≠tulo (ex: 'sa√∫de', 'educa√ß√£o', 'ambiente')..." aria-label="Pesquisar iniciativas" />
                            <button id="search-btn" class="search-btn" onclick="performSearch()" aria-label="Pesquisar">Pesquisar</button>
                            <button id="clear-search-btn" class="clear-search-btn" onclick="clearSearch()" aria-label="Limpar pesquisa">Limpar</button>
                        </div>
                        <div id="search-results-info" class="search-results-info"></div>
                    </div>

                    <div id="initiatives" class="loading" role="status" aria-live="polite">A carregar iniciativas...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- AGENDA VIEW -->
    <div id="agenda-view" class="view" role="tabpanel" aria-labelledby="agenda-tab">
        <div class="container">
            <div class="agenda-header">
                <h1>Agenda Parlamentar</h1>
                <p>Calend√°rio da XVII Legislatura</p>
            </div>

            <div class="agenda-controls">
                <div class="legend">
                    <label class="legend-filter active" data-type="plenary">
                        <input type="checkbox" checked onchange="toggleAgendaFilter('plenary', this.checked)">
                        <span class="legend-shape bg-plenary"></span>
                        <span>Plen√°rio</span>
                    </label>
                    <label class="legend-filter active" data-type="committee">
                        <input type="checkbox" checked onchange="toggleAgendaFilter('committee', this.checked)">
                        <span class="legend-shape bg-committee"></span>
                        <span>Comiss√µes</span>
                    </label>
                    <label class="legend-filter active" data-type="groups">
                        <input type="checkbox" checked onchange="toggleAgendaFilter('groups', this.checked)">
                        <span class="legend-shape bg-groups"></span>
                        <span>Grupos Parlamentares</span>
                    </label>
                    <label class="legend-filter active" data-type="conference">
                        <input type="checkbox" checked onchange="toggleAgendaFilter('conference', this.checked)">
                        <span class="legend-shape bg-conference"></span>
                        <span>Conf. L√≠deres</span>
                    </label>
                    <label class="legend-filter active" data-type="workgroup">
                        <input type="checkbox" checked onchange="toggleAgendaFilter('workgroup', this.checked)">
                        <span class="legend-shape bg-workgroup"></span>
                        <span>Grupos Trabalho</span>
                    </label>
                    <label class="legend-filter active" data-type="visits">
                        <input type="checkbox" checked onchange="toggleAgendaFilter('visits', this.checked)">
                        <span class="legend-shape bg-visits"></span>
                        <span>Visitas</span>
                    </label>
                    <label class="legend-filter active" data-type="assistances">
                        <input type="checkbox" checked onchange="toggleAgendaFilter('assistances', this.checked)">
                        <span class="legend-shape bg-assistances"></span>
                        <span>Assist√™ncias</span>
                    </label>
                </div>
                <div class="view-toggle">
                    <button class="view-btn" data-view="grid" onclick="setAgendaView('grid')">Grelha</button>
                    <button class="view-btn active" data-view="timeline" onclick="setAgendaView('timeline')">Cronograma</button>
                </div>
            </div>

            <div id="agenda" class="loading" role="status" aria-live="polite">A carregar agenda...</div>
        </div>
    </div>

    <!-- COMISS√ïES VIEW -->
    <div id="comissoes-view" class="view" role="tabpanel" aria-labelledby="comissoes-tab">
        <div class="container">
            <h1 class="page-title">Comiss√µes Parlamentares</h1>
            <p class="page-subtitle">Composi√ß√£o partid√°ria das comiss√µes da XVII Legislatura</p>

            <div id="comissoes-content" class="loading" role="status" aria-live="polite">
                A carregar comiss√µes...
            </div>
        </div>
    </div>

    <!-- ASSEMBLEIA VIEW -->
    <div id="assembleia-view" class="view" role="tabpanel" aria-labelledby="assembleia-tab">
        <div class="container">
            <h1 class="page-title">A Assembleia</h1>
            <p class="page-subtitle">Deputados da XVII Legislatura por partido, c√≠rculo eleitoral e g√©nero</p>

            <div id="assembleia-content" class="loading" role="status" aria-live="polite">
                A carregar deputados...
            </div>
        </div>
    </div>

    </main>

    <!-- Footer -->
    <footer>
        <p>
            Fonte de dados: <a href="https://www.parlamento.pt" target="_blank">Parlamento.pt</a> |
            XVII Legislatura (2025-presente) |
            API: <a href="https://viriato-api.onrender.com/api/health" target="_blank">viriato-api.onrender.com</a> |
            <a href="javascript:void(0)" onclick="openFeedbackModal()" style="cursor: pointer;">Enviar Feedback</a>
        </p>
    </footer>


    <!-- Agenda Initiatives Modal -->
    <div id="agenda-initiatives-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-header-content">
                    <div class="modal-title" id="modal-event-title">Evento</div>
                    <div class="modal-subtitle" id="modal-event-subtitle"></div>
                </div>
                <button class="modal-close" onclick="closeAgendaModal()" aria-label="Fechar">√ó</button>
            </div>
            <div class="modal-body" id="modal-initiatives-body">
                <!-- Content loaded dynamically -->
            </div>
        </div>
    </div>

    <!-- Feedback Modal -->
    <div id="feedback-modal" class="modal-overlay" onclick="closeFeedbackModal(event)">
        <div class="modal-content" style="max-width: 550px;" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-header-content">
                    <div class="modal-title">Enviar Feedback</div>
                    <div class="modal-subtitle">Ajude-nos a melhorar o Viriato</div>
                </div>
                <button class="modal-close" onclick="closeFeedbackModal()" aria-label="Fechar">√ó</button>
            </div>
            <div class="modal-body" id="feedback-modal-body">
                <form id="feedback-form" class="feedback-form" onsubmit="submitFeedback(event)">
                    <div id="feedback-error" class="feedback-error" style="display: none;"></div>

                    <div class="form-group">
                        <label for="feedback-title">Titulo</label>
                        <input type="text" id="feedback-title" name="title"
                               placeholder="Ex: Sugestao de nova funcionalidade"
                               required minlength="5" maxlength="200">
                    </div>

                    <div class="form-group">
                        <label for="feedback-description">Descricao</label>
                        <textarea id="feedback-description" name="description"
                                  placeholder="Descreva a sua sugestao, problema encontrado ou ideia de melhoria..."
                                  required minlength="10" maxlength="5000"></textarea>
                    </div>

                    <div class="form-group">
                        <label for="feedback-email">Email <span class="optional">(opcional)</span></label>
                        <input type="email" id="feedback-email" name="email"
                               placeholder="Para recebermos resposta">
                    </div>

                    <!-- Honeypot field - hidden from users, catches bots -->
                    <input type="text" name="honeypot" class="ohnohoney" tabindex="-1" autocomplete="off">

                    <button type="submit" class="feedback-submit" id="feedback-submit-btn">
                        Enviar Feedback
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
